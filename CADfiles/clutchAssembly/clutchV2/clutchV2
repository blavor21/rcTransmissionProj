Turns out I made a large mistake with the previous version, preventing it from working at all. This is the simplified updated version, V2.
